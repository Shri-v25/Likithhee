<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday!</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #222;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            text-align: center;
        }

        h1 { margin-bottom: 20px; color: #ffeb3b; }

        /* The Puzzle Container */
        #puzzle-container {
            width: 300px;
            height: 300px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            border: 5px solid #fff;
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
            background-color: #333; /* Placeholder color if image fails */
        }

        /* Individual Puzzle Pieces */
        .piece {
            width: 100px;
            height: 100px;
            /* CRITICAL CHANGE: Updated to .jpeg */
            background-image: url('gift.jpeg'); 
            background-size: 300px 300px; /* Must match container size */
            cursor: pointer;
            border: 1px solid rgba(0,0,0,0.3); /* faint border to see pieces */
            box-sizing: border-box;
            transition: transform 0.2s;
        }

        /* Highlight selected piece */
        .selected {
            border: 2px solid #ffeb3b;
            z-index: 10;
            transform: scale(0.95);
            opacity: 0.8;
        }

        /* The "Gift Obtained" Overlay */
        #success-overlay {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        #success-overlay h2 {
            font-size: 3rem;
            color: #ffeb3b;
            margin-bottom: 20px;
            animation: popIn 0.5s ease;
        }

        #success-overlay p {
            font-size: 1.5rem;
            max-width: 80%;
            line-height: 1.5;
        }

        @keyframes popIn {
            0% { transform: scale(0); }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

    <h1>Solve to Reveal Your Gift!</h1>
    <p>Click one piece, then click another to swap them until the picture is complete.</p>

    <div id="puzzle-container">
        </div>

    <div id="success-overlay">
        <h2>ðŸŽ‰ PUZZLE SOLVED! ðŸŽ‰</h2>
        <p>Your gift has materialized in the real world...</p>
        <p style="color: #ffeb3b; font-weight: bold; margin-top: 20px;">LOOK NEXT TO YOU NOW!</p>
    </div>

    <script>
        const container = document.getElementById('puzzle-container');
        const overlay = document.getElementById('success-overlay');
        const gridSize = 3; // 3x3 grid
        let selectedPiece = null;

        // 1. Create the correct order (0 to 8)
        const correctOrder = [0, 1, 2, 3, 4, 5, 6, 7, 8];
        let currentOrder = [...correctOrder];

        // 2. Shuffle functionality
        // We shuffle until it is NOT the correct order
        do {
            currentOrder.sort(() => Math.random() - 0.5);
        } while (JSON.stringify(currentOrder) === JSON.stringify(correctOrder));

        // 3. Render the grid
        function renderPuzzle() {
            container.innerHTML = '';
            currentOrder.forEach((val, index) => {
                const div = document.createElement('div');
                div.classList.add('piece');
                
                // Calculate background position based on the VALUE (the actual image part)
                // Row and Col of the original image part
                const row = Math.floor(val / gridSize);
                const col = val % gridSize;
                
                div.style.backgroundPosition = `-${col * 100}px -${row * 100}px`;
                
                // Store the current index (where it is now) for swapping logic
                div.dataset.index = index; 
                
                div.addEventListener('click', onPieceClick);
                container.appendChild(div);
            });
        }

        // 4. Handle Clicks (Swap Logic)
        function onPieceClick(e) {
            const clickedPiece = e.target;

            if (selectedPiece === clickedPiece) {
                // Deselect if clicked again
                selectedPiece.classList.remove('selected');
                selectedPiece = null;
                return;
            }

            if (!selectedPiece) {
                // First click: Select
                selectedPiece = clickedPiece;
                clickedPiece.classList.add('selected');
            } else {
                // Second click: Swap
                const idx1 = parseInt(selectedPiece.dataset.index);
                const idx2 = parseInt(clickedPiece.dataset.index);

                // Swap in the array
                const temp = currentOrder[idx1];
                currentOrder[idx1] = currentOrder[idx2];
                currentOrder[idx2] = temp;

                // Reset selection and re-render
                selectedPiece = null;
                renderPuzzle();
                
                // Check win
                checkWin();
            }
        }

        // 5. Check if solved
        function checkWin() {
            // Compare current order to correct order
            if (JSON.stringify(currentOrder) === JSON.stringify(correctOrder)) {
                setTimeout(() => {
                    overlay.style.display = 'flex';
                }, 300); // Slight delay so he sees the final piece snap in
            }
        }

        // Initial Start
        renderPuzzle();

    </script>
</body>
</html>