<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birthday Mission!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Montserrat:wght@600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --tt-purple: #2c0b3f;
            --tt-cyan: #00f7ff;
            --tt-yellow: #ffeb3b;
            --tt-orange: #ff5722;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            /* Teen Titans style dark comic city background gradient */
            background: linear-gradient(135deg, var(--tt-purple) 0%, #1a0527 100%);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            text-align: center;
            overflow: hidden;
            padding: 20px;
        }
        
        /* Background aesthetic elements */
        body::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(0, 247, 255, 0.2) 0%, transparent 40%),
                radial-gradient(circle at 80% 20%, rgba(255, 87, 34, 0.15) 0%, transparent 40%);
            z-index: -1;
        }

        h1 {
            font-family: 'Bangers', cursive; /* Cinematic comic font */
            font-size: 3.5rem;
            margin-bottom: 10px;
            color: var(--tt-yellow);
            /* Comic book text effect */
            text-shadow: 3px 3px 0px var(--tt-orange), -2px -2px 0px var(--tt-cyan), 4px 4px 10px rgba(0,0,0,0.8);
            letter-spacing: 2px;
        }
        
        p.instructions {
            font-size: 1.1rem;
            color: var(--tt-cyan);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 30px;
            text-shadow: 0 0 10px rgba(0, 247, 255, 0.5);
        }

        /* The Puzzle Container */
        #puzzle-outline {
            /* A container to give a cool border effect */
            padding: 10px;
            background: linear-gradient(45deg, var(--tt-cyan), var(--tt-purple));
            border-radius: 15px;
            box-shadow: 
                0 0 30px rgba(0, 247, 255, 0.4),
                inset 0 0 20px rgba(0,0,0,0.5);
        }

        #puzzle-container {
            width: 300px;
            height: 300px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 4px; /* Gaps between tiles for traditional feel */
            background-color: rgba(0,0,0,0.5);
            border-radius: 10px;
            padding: 4px;
        }

        /* Individual Puzzle Pieces */
        .piece {
            width: 100%; /* Fills grid cell */
            height: 100%;
            background-image: url('gift.jpeg'); 
            background-size: 300px 300px; 
            cursor: pointer;
            
            /* Traditional Tile aesthetics */
            border-radius: 8px;
            box-shadow: inset 3px 3px 5px rgba(255,255,255,0.3), inset -3px -3px 5px rgba(0,0,0,0.5);
            border: 2px solid #1a0527;

            /* BLUR EFFECT applied initially */
            filter: blur(5px) grayscale(50%);
            transition: transform 0.2s, filter 0.5s, border-color 0.2s;
        }
        
        /* Class added when puzzle is won to clear image */
        .piece.solved-state {
            filter: blur(0px) grayscale(0%);
            box-shadow: none;
            border: none;
            border-radius: 0;
            gap: 0;
        }

        /* Highlight selected piece */
        .selected {
            border: 3px solid var(--tt-yellow) !important;
            z-index: 10;
            transform: scale(0.95);
            filter: blur(5px) grayscale(50%) brightness(1.2); /* Keep blurred but brighten */
            box-shadow: 0 0 20px var(--tt-yellow);
        }

        /* The "Gift Obtained" Overlay */
        #success-overlay {
            display: none; 
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 0, 20, 0.97);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        #success-overlay h2 {
            font-family: 'Bangers', cursive;
            font-size: 5rem;
            color: var(--tt-yellow);
            text-shadow: 4px 4px 0px var(--tt-orange);
            margin-bottom: 10px;
            animation: popIn 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        #reveal-text {
            font-size: 2rem;
            color: var(--tt-cyan);
            font-weight: 800;
            text-transform: uppercase;
            animation: pulse 1.5s infinite;
        }

        @keyframes popIn {
            0% { transform: scale(0) rotate(-20deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
    </style>
</head>
<body>

    <h1>TITANS MISSION: UNLOCK THE GIFT</h1>
    <p class="instructions">Tap two tiles to swap their positions.</p>

    <div id="puzzle-outline">
        <div id="puzzle-container">
            </div>
    </div>

    <div id="success-overlay">
        <h2>MISSION ACCOMPLISHED!</h2>
        <p style="font-size: 1.2rem; color: white; margin-top: 20px;">The object has materialized.</p>
        <p id="reveal-text">LOOK NEXT TO YOU NOW!</p>
    </div>

    <script>
        const container = document.getElementById('puzzle-container');
        const overlay = document.getElementById('success-overlay');
        const puzzleOutline = document.getElementById('puzzle-outline');
        const gridSize = 3;
        let selectedPiece = null;
        let isSolved = false;

        // 1. Create correct order
        const correctOrder = [0, 1, 2, 3, 4, 5, 6, 7, 8];
        let currentOrder = [...correctOrder];

        // 2. Shuffle until not solved
        do {
            currentOrder.sort(() => Math.random() - 0.5);
        } while (JSON.stringify(currentOrder) === JSON.stringify(correctOrder));

        // 3. Render the grid
        function renderPuzzle() {
            container.innerHTML = '';
            currentOrder.forEach((val, index) => {
                const div = document.createElement('div');
                div.classList.add('piece');
                
                // If solved, remove tile effects and blur
                if (isSolved) {
                     div.classList.add('solved-state');
                }
                
                const row = Math.floor(val / gridSize);
                const col = val % gridSize;
                
                div.style.backgroundPosition = `-${col * 100}px -${row * 100}px`;
                div.dataset.index = index; 
                
                // Only allow clicking if not yet solved
                if (!isSolved) {
                    div.addEventListener('click', onPieceClick);
                }
                container.appendChild(div);
            });
        }

        // 4. Handle Clicks (Swap Logic)
        function onPieceClick(e) {
            if (isSolved) return; // Stop interaction if won

            const clickedPiece = e.target;

            if (selectedPiece === clickedPiece) {
                selectedPiece.classList.remove('selected');
                selectedPiece = null;
                return;
            }

            if (!selectedPiece) {
                selectedPiece = clickedPiece;
                clickedPiece.classList.add('selected');
            } else {
                const idx1 = parseInt(selectedPiece.dataset.index);
                const idx2 = parseInt(clickedPiece.dataset.index);

                const temp = currentOrder[idx1];
                currentOrder[idx1] = currentOrder[idx2];
                currentOrder[idx2] = temp;

                selectedPiece = null;
                renderPuzzle();
                checkWin();
            }
        }

        // 5. Check if solved
        function checkWin() {
            if (JSON.stringify(currentOrder) === JSON.stringify(correctOrder)) {
                isSolved = true;
                
                // Re-render to apply the "un-blurred" style immediately
                renderPuzzle();
                
                // Remove grid gaps for seamless image
                container.style.gap = "0";
                container.style.padding = "0";
                puzzleOutline.style.background = "var(--tt-yellow)";
                puzzleOutline.style.boxShadow = "0 0 50px var(--tt-yellow)";

                // Show overlay after a moment to admire the clear image
                setTimeout(() => {
                    overlay.style.display = 'flex';
                }, 1500); 
            }
        }

        // Initial Start
        renderPuzzle();

    </script>
</body>
</html>
